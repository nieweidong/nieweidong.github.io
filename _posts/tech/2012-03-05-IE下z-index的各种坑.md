---
layout: post
modified:
categories: tech
excerpt:
tags: [CSS]
image:
  feature:
  credit: 网络
  creditlink: javascript:;
---

<div id="cnblogs_post_body"><p>&#12288;&#12288;到新地方有些日子了，差不多适应了这边的工作节奏与流程。接到的第一个开发任务是几个比较简单的页面，需要做的工作就是先把设计图变成页面，然后使用PHP创建几个请求的接口传递数据，标准且简洁的web开发思路。可是真有些日子没有写DIV+CSS了，而且对IE6兼容性的坑碰到的还是不够多(以前做国外项目)，所以这次开发中不可避免的碰见了几个问题，尤其是在IE下的 z-index 问题很有意思，所以整理了一些资料和总结分享给大家...注：因为引入了jsfiddle，所以页面加载受影响会稍慢一些^_^&#12288;&#12288;</p>
<p><strong>&#12288;&#12288;<span style="font-size: 14pt;">阅读目录</span>：</strong></p>
<ol>
<li><a href="#darren_1" style="font-size: 16px;">z-index属性</a></li>
<li><a href="#darren_2" style="font-size: 16px;">z-index规范参考</a></li>
<li><a href="#darren_3" style="font-size: 16px;">在IE下出现的问题</a></li>
<li><a href="#darren_4" style="font-size: 16px;">在IE6下z-index的问题</a><ol>
<li>&gt;<a href="#darren_5">拼爹的时代</a></li>
<li>&gt;<a href="#darren_6">万恶的float&nbsp;</a></li>
</ol></li>
<li><a href="#darren_7" style="font-size: 16px;">IE6下 select z-index无效而遮挡div</a><ol>
<li>&gt;<a href="#darren_8">用 iframe 包裹 select 元素</a></li>
<li>&gt;<a href="#darren_9">以 Iframe 作为div的子元素，覆盖 select 元素</a></li>
</ol></li>
<li><span style="font-size: 16px;"><a data-mce-="" href="#darren_11">本文结语</a></span></li>
<li><a href="#darren_10" style="font-size: 16px;">参考资料</a></li>
</ol>
<div>&nbsp;</div>
<h1 id="darren_1">&#12288;&#12288;z-index属性&#12288;&#12288;</h1>
<ol>
<li>z-index : auto | number</li>
<li>z-index 属性设置元素的堆叠顺序，如果为正数，则离用户更近，为负数则表示离用户更远；</li>
<li>拥有更高堆叠顺序的元素总是会处于堆叠顺序较低的元素的前面；</li>
<li>z-index 仅能在定位元素上奏效（position 属性值为 relative 或 absolute 或 fixed的对象）。</li>
</ol>
<div>&nbsp;</div>
<h1 id="darren_2">&#12288;&#12288;z-index规范参考&#12288;&#12288;</h1>
<div>
<ul>
<li>在 W3C CSS2.1 规范中，<strong>每个元素都具有三维的空间位置</strong>，除我们所熟悉的水平和垂直位置外，元素还可在 "Z轴" 方向上层层相叠、依次向前排开；&nbsp;</li>
<li>元素在 "Z 轴" 方向上的呈现顺序，由层叠上下文和层叠级别决定。在文档中，每个元素仅属于一个层叠上下文。在给定的层叠上下文中，<strong>每个元素都有一个整型的层叠级别</strong>，它描述了在相同层叠上下文中元素在 "Z轴" 上的显示顺序；</li>
<li>同一个层叠上下文中，层叠级别大的显示在上，层叠级别小的显示在下，<strong>相同层叠级别时，遵循后来居上的原则</strong>（back-to-font）；</li>
<li>不同层叠上下文中，元素显示顺序以父级层叠上下文的层叠级别来决定显示的先后顺序。与自身的层叠级别无关；</li>
<li>每一个定位元素都归属于一个stacking context。根元素形成 root stacking context，而其他的 stacking context 则由定位元素产生（此定位元素的 z-index 被定义一个非 auto 的 z-index 值），定位子元素会以这个 local stacking context 为参考，用相同的规则来决定层叠顺序；</li>
<li>当任何一个元素层叠另一个包含在不同 stacking context 元素时，则会以 stacking context 的层叠级别（stack level）来决定显示的先后情况。也就是说，在相同的 stacking context 下才会用<strong>元素本身</strong>的 z-index 来决定先后，不同时则由 stacking context 的<strong>父元素</strong>的 z-index 来决定。</li>
</ul>
<div>&nbsp;</div>
</div>
<h1 id="darren_3"><span style="font-size: 18pt;">&#12288;&#12288;在IE下出现的问题&#12288;&#12288;</span></h1>
<p>&#12288;&#12288;当定位元素的 'z-index' 未设置时（默认为 auto），在&nbsp;<em>IE6 IE7 IE8(Q)</em>&nbsp;下将会创建一个新的局部层叠上下文。而在其它浏览器下，则严格按照规范，不产生新的局部层叠上下文。</p>
<p>&#12288;&#12288;这个问题将导致定位元素的层叠关系在不同浏览器出现很大的区别，严重的可导致页面布局混乱、内容覆盖等。</p>
<p>&#12288;&#12288;受影响的浏览器有IE6 IE7 IE8(Quriks Mode)</p>
<p>&#12288;&#12288;直接从w3help复制了代码，分析以下代码：</p>
<div class="cnblogs_code">
<pre>&lt;style type=<span style="color: #800000;">"</span><span style="color: #800000;">text/css</span><span style="color: #800000;">"</span>&gt;<br>  body { margin:<span style="color: #800080;">0</span>; }<br>  .p1{ top:20px; height:50px; width:150px; background-color:blue;}<br>  .p2{ top:10px; left:20px; height:30px; width:100px; background-color:yellow;}<br>  .p3{ top:0px; left:50px; height:100px; width:50px; background-color:red;}<br>&lt;/style&gt;<br><br>&lt;div style=<span style="color: #800000;">"</span><span style="color: #800000;">position:relative;</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">p1</span><span style="color: #800000;">"</span>&gt;<span style="color: #800080;">1</span><br>    &lt;div style=<span style="color: #800000;">"</span><span style="color: #800000;">position:absolute; z-index:1;</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">p2</span><span style="color: #800000;">"</span>&gt;<span style="color: #800080;">2</span>&lt;/div&gt;<br>&lt;/div&gt;<br>&lt;div style=<span style="color: #800000;">"</span><span style="color: #800000;">position:absolute;</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">p3</span><span style="color: #800000;">"</span>&gt;<span style="color: #800080;">3</span>&lt;/div&gt;</pre>
</div>
<p>&#12288;&#12288;<img alt="" src="http://pic002.cnblogs.com/images/2012/159097/2012022921011169.jpg"></p>
<p>&#12288;&#12288;注：Q代表Quriks Mode，即混杂模式。</p>
<p>&#12288;&#12288;根据 W3C CSS2.1 规范中的说明，定位元素【p1】和【p3】由于未设置 'z-index' 特性（使用默认值 auto），它们不会创建新的局部层叠上下文，而定位元素【p2】设置了 z-index:1 则会创建新的层叠上下文。</p>
<p>&#12288;&#12288;另，在同一根层叠上下文中，同为 z-index:auto 的定位元素【p1】和【p3】，它们的层叠级别相同，但【p3】在【p1】之后，所以在 Z 轴上【p3】比【p1】靠前显示，又，【p2】层叠上下文的层叠级别为正数，所以【p2】的层叠级别要比【p3】高。因此，它们在 Z 轴上的顺序为：（遵循 back-to-font）【p1】 -&gt; 【p3】 -&gt; 【p2】</p>
<p>&#12288;&#12288;以上为标准浏览器下的情况。</p>
<p>&#12288;&#12288;而在 IE6 IE7 E8(Q) 下，定位元素【p1】和【p3】都创建了新的局部层叠上下文，在同一根层叠上下文中，它们的层叠级别相同，但【p3】在【p1】之后，所以在 Z 轴上【p3】比【p1】靠前显示。此时，由于【p2】处于【p1】的层叠上下文中，所以【p2】在 Z 轴上要比【p3】靠后。</p>
<p>&#12288;&#12288;在来一个例子：</p>
<div class="cnblogs_code">
<pre>&lt;style&gt;<br>  .parent{width:200px; height:200px; padding:10px;}<br>  .sub{text-align:right; font:15px Verdana;width:100px; height:100px;}<br>  .lt50{left:50px;top:50px;}<br>&lt;/style&gt;<br><br>&lt;div style=<span style="color: #800000;">"</span><span style="color: #800000;">position:absolute; background:lightgrey;</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">parent</span><span style="color: #800000;">"</span>&gt;<br>    &lt;div style=<span style="color: #800000;">"</span><span style="color: #800000;">position:absolute;z-index:20;background:darkgray;</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">sub</span><span style="color: #800000;">"</span>&gt;<span style="color: #800080;">20</span>&lt;/div&gt;<br>    &lt;div style=<span style="color: #800000;">"</span><span style="color: #800000;">position:absolute;z-index:10;background:dimgray;</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">sub lt50</span><span style="color: #800000;">"</span>&gt;<span style="color: #800080;">10</span>&lt;/div&gt;<br>&lt;/div&gt;<br>&lt;div style=<span style="color: #800000;">"</span><span style="color: #800000;">position:absolute;left:80px;top:80px;background:black;</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">parent</span><span style="color: #800000;">"</span>&gt;<br>    &lt;div style=<span style="color: #800000;">"</span><span style="color: #800000;">position:absolute;z-index:2;background:darkgray;</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">sub</span><span style="color: #800000;">"</span>&gt;<span style="color: #800080;">2</span>&lt;/div&gt;<br>    &lt;div style=<span style="color: #800000;">"</span><span style="color: #800000;">position:absolute;z-index:1;background:dimgray;</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">sub lt50</span><span style="color: #800000;">"</span>&gt;<span style="color: #800080;">1</span>&lt;/div&gt;<br>&lt;/div&gt;</pre>
</div>
<p>&#12288;&#12288;<img alt="" src="http://pic002.cnblogs.com/images/2012/159097/2012022921053279.jpg"></p>
<p><strong><span style="background-color: #ccffff; font-size: 18pt;">&#12288;&#12288;解决办法&#12288;&#12288;</span></strong></p>
<p>&#12288;&#12288;理解层叠上下文、层叠级别与 'z-index' 之间的关系。在可能出现定位元素相互覆盖的情况时，明确指定定位元素的 'z-index' 特性，避免此问题的出现。</p>
<p>&#12288;&#12288;注：此段内容基本都是来自w3help。</p>
<p>&nbsp;</p>
<h1 id="darren_4">&#12288;&#12288;在IE6下z-index的问题</h1>
<p>&#12288;&#12288;我不是一个喜欢抱怨的人，so...有关抱怨IE6的话在此省略500字...</p>
<p>&#12288;&#12288;先上个图说说我在工作中实际遇到的问题：</p>
<p>&#12288;&#12288;<img alt="" src="http://pic002.cnblogs.com/images/2012/159097/2012030114264812.jpg"></p>
<p>&#12288;&#12288;图片的上半部分就是在非IE6下的交互，图片下半部分是在IE6下的显示效果，当打开虚拟机测试的时候我表示瞬间碉堡了，囧...在IE6下这个tips被盖住了，很明显这个不是我想要的效果，可是为什么会出现这个情况类？接着往下看。</p>
<p><span style="font-size: 18pt; background-color: #ccffff;">&#12288;&#12288;分析此类问题的原因：&#12288;&#12288;</span></p>
<p>&#12288;&#12288;<span style="font-size: 16px;" id="darren_5"><strong>1.这是个拼爹的时代，在IE6下很好的体现了这点...囧</strong></span></p>
<p>&#12288;&#12288;按照正常的思维，z-index层级越高，内容越应该在上面显示，在大部分的浏览器在大部分的情况下，确实如此，但是不绝对。尤其遇到IE6。</p>
<p>&#12288;&#12288;在IE6下的层级高低不仅要看本身，还要看自己的父元素是否给力：父元素的 position 属性为 relative或absolute 时，子元素的 absolute 属性是相对于父元素而言的。而在IE6下的层级的表现有时候不是看子元素的 z-index 多高，而要看它们的父元素的 z-index 谁高谁低。点击 Result 可以看到HTML对应的VIEW。</p>
<p><iframe width="100%" height="380" src="http://jsfiddle.net/DarrenCode/D6kfs/2/embedded/html,result"></iframe></p>
<p>&#12288;&#12288;从以上的代码中可以看到最内层&lt;div&gt;的z-index属性为999，其父元素的z-index属性为100。按照正常的显示逻辑，图片应该正常显示且不会被背景色所影响，可是在IE6下会有问题，直接上图片会比较直观，比较看看IE6下和非IE6浏览器的显示效果。chrome、FF和opera都经过测试了，为了不使图片过多我就拿个chrome的截图吧。</p>
<p>&#12288;&#12288;<img alt="" src="http://pic002.cnblogs.com/images/2012/159097/2012030122580824.jpg"></p>
<p>&#12288;&#12288;重现这个bug的条件很简单，只要绝对定位（position:absolute）&lt;div&gt;的祖先元素，或者说是最顶级的祖先元素的 relative 属性小于黑色半透明层的z-index层级即可。解决办法也很简单，只需要给的祖先元素加上z-index就可以。</p>
<p>&#12288;&#12288;<img alt="" src="http://pic002.cnblogs.com/images/2012/159097/2012030418365071.jpg" style="width: 760px;"></p>
<p>&#12288;&#12288;为具有 relative 属性的顶级祖先元素打了鸡血(加了z-index)后，IE6下终于正常显示了。这个问题很现实的教育了我们 - 在拼爹拼不过的条件下我们只能靠自己努力...</p>
<p>&#12288;&#12288;IE6下拼爹的问题也就是我在实际开发中碰到的问题，现在已经完美解决且达到需求的效果了。接下来要介绍的是一些我总结的资料，都是介绍在IE环境下得各种z-index的坑。</p>
<p>&#12288;&#12288;</p>
<p>&nbsp;&#12288;&#12288;<span style="font-size: 16px;" id="darren_6"><strong>2.万恶的float</strong></span></p>
<p>&#12288;&#12288;float 是 css 的定位属性，而且应该是CSS中最常用的属性之一了，至于为什么说它万恶等我改天去准备一篇文章单独进行解说，在这里借着以前的学习笔记简单说几点：</p>
<p>&#12288;&#12288;1. IE7 中，底边距 bug是当浮动父元素有浮动子元素时，这些子元素的底边距会被父元素忽略掉；</p>
<p>&#12288;&#12288;2.&nbsp;3像素间距是指挨着浮动元素的文本会神奇的被踢出去3像素，好像浮动元素的周围有一个奇怪的力场一样；</p>
<p>&#12288;&#12288;3.&nbsp;双倍边距bug处理 IE6 时，另一个需要记住的事情是，如果在和浮动方向相同的方向上设置外边距(margin)，会引发双倍边距。</p>
<p>&#12288;&#12288;有关float的扫盲就先到这里，还有一点就是float毕竟是标准的属性，而且大多数的前端都习惯用它去实现页面，所以我的建议就是：深入理解 HTML语义和表现。</p>
<p>&#12288;&#12288;接着开始讲述 z-index和float 在IE6环境下擦出的坑爹的火花...先上一段代码：</p>
<div class="cnblogs_code">
<pre>&#12288;&#12288;&lt;div style=<span style="color: #800000;">"</span><span style="color: #800000;">background:#000;width:100%;height:600px;opacity:0.3; filter:alpha(opacity=30);position:absolute;left:0;top:0;z-index:1;overflow:hidden;</span><span style="color: #800000;">"</span>&gt;&lt;/div&gt;<br>&#12288;&#12288;&lt;div style=<span style="color: #800000;">"</span><span style="color: #800000;">position:relative;z-index:100;</span><span style="color: #800000;">"</span>&gt;<br>&#12288;&#12288;&#12288;&#12288;&lt;img src=<span style="color: #800000;">"</span><span style="color: #800000;">http://images.cnblogs.com/cnblogs_com/Darren_code/311197/o_1.jpg</span><span style="color: #800000;">"</span> style=<span style="color: #800000;">"</span><span style="color: #800000;">float:left;</span><span style="color: #800000;">"</span> width=<span style="color: #800000;">"</span><span style="color: #800000;">300</span><span style="color: #800000;">"</span> /&gt;<br>&#12288;&#12288;&lt;/div&gt;</pre>
</div>
<p>&#12288;&#12288;看到&lt;img&gt;有设置float属性，上面这段代码显示的效果与IE6下拼爹失败一样，IE6下的犀牛书是灰色的 T.T 。为了让犀牛书正常显示，只需要把&lt;img&gt;的float属性去掉即可。</p>
<p>&#12288;&#12288;个人理解可能是因为&lt;img&gt;的float使得z-index失效造成的。网上还有种说法是因为float和relative两者在定位上问题，所以一起使用的时候会造成此bug。</p>
<p>&#12288;&#12288;这个问题又教育了我们 - 某些环境(IE6)下也要小心被兄弟坑...</p>
<p>&nbsp;</p>
<h1 id="darren_7">&#12288;&#12288;IE6下 select z-index无效而遮挡div</h1>
<p>&#12288;&#12288;这个问题其实在是比较常见的了，我早期做项目的时候有幸遇见过这个问题，所以有现成的资料，趁着这次也刚好整理整理、回忆回忆。两个解决办法都是围绕iframe展开的，咱们先来看第一个。</p>
<p>&#12288;&#12288;<strong id="darren_8">1.用 iframe 包裹 select 元素</strong></p>
<p>&#12288;&#12288;使用iframe包住select，这样iframe可以有z-index，只要在div上设置的z-index比iframe的高即可实现。示例代码如下：&nbsp;</p>
<div class="cnblogs_code">
<pre>&#12288;&#12288;&lt;iframe style=<span style="color: #800000;">"</span><span style="color: #800000;">z-index:1;position: absolute; </span><span style="color: #800000;">"</span>&gt;<br>&#12288;&#12288;&#12288;&#12288;&lt;<span style="color: #0000ff;">select</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">me</span><span style="color: #800000;">"</span>&gt;                    <br>&#12288;&#12288;&#12288;&#12288;&#12288;&#12288;&lt;option value=<span style="color: #800000;">"</span><span style="color: #800000;">name</span><span style="color: #800000;">"</span>&gt;Darren聂微东&lt;/option&gt;     <br>&#12288;&#12288;&#12288;&#12288;&#12288;&#12288;&lt;option value=<span style="color: #800000;">"</span><span style="color: #800000;">sex</span><span style="color: #800000;">"</span>&gt;male&lt;/option&gt;     <br>&#12288;&#12288;&#12288;&#12288;&#12288;&#12288;&lt;option value=<span style="color: #800000;">"</span><span style="color: #800000;">age</span><span style="color: #800000;">"</span>&gt;secret&lt;/option&gt;     <br>&#12288;&#12288;&#12288;&#12288;&lt;/<span style="color: #0000ff;">select</span>&gt;     <br>&#12288;&#12288;&lt;/iframe&gt;</pre>
</div>
<p>&nbsp;</p>
<p>&#12288;&#12288;<strong id="darren_9">2.以 Iframe 作为div的子元素，覆盖 select 元素(推荐使用)</strong><br>&#12288;&#12288;建立一个跟div同宽同高的iframe，并且z-index比div要低。</p>
<div class="cnblogs_code">
<pre>&lt;style type="text/css"&gt;<br>#iframe{   <br>    position: absolute;<br>    width: <span style="color: #800080;">100</span>%;<br>    height: <span style="color: #800080;">100</span>%;<br>    z-index:-<span style="color: #800080;">1</span>;<br>}   <br>.text_div{   <br>    position: absolute;   <br>    left:100px;   <br>    top:50px;   <br>    width: 300px;   <br>    height: 200px;   <br>    background : blue;     <br>    z-index:<span style="color: #800080;">100</span>;   <br>}   <br>&lt;/style&gt;<br>&lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">text_div</span><span style="color: #800000;">"</span>&gt;  <br>     &lt;span&gt;这里可以包含其他dom元素&lt;/span&gt;  <br>     &lt;iframe id=<span style="color: #800000;">"</span><span style="color: #800000;">iframe</span><span style="color: #800000;">"</span>&gt;&lt;/iframe&gt;  <br>&lt;/div&gt;</pre>
</div>
<p>&#12288;&#12288;注:在这里如果不加src属性,尽管iframe会把select挡住,但是由于默认iframe为白色,会影响原来的div背景色。解决方法可以加了一个空的HTML文件，并把body 的值设为和原来div背景色一致,这样就解决了默认白色背景色的问题，这里只是一种思路，<strong>办法总比困难多&nbsp;</strong>^_^。<br><br></p>
<h1 id="darren_11">&#12288;&#12288;本文结语</h1>
<p>&#12288;&#12288;与很多做国内项目的前端一样，我也会常常忍不住诅咒IE，可是假如换个思考方式我们也得感谢它，工作因为它才有了更多挑战和成就感。</p>
<p>&#12288;&#12288;对不理解CSS层叠朋友来说&nbsp;z-index 确实是一个大坑，希望这篇文章能够给那些掉到坑内的朋友一些帮助。</p>
<p>&nbsp;</p>
<h1 id="darren_10">&#12288;&#12288;参考资料：</h1>
<ul>
<li><a href="http://www.w3.org/TR/CSS21/visuren.html#z-index">http://www.w3.org/TR/CSS21/visuren.html#z-index</a></li>
<li><a href="http://www.zhangxinxu.com/wordpress/?p=471">http://www.zhangxinxu.com/wordpress/?p=471</a></li>
<li><a href="http://www.w3school.com.cn/css/pr_pos_z-index.asp">http://www.w3school.com.cn/css/pr_pos_z-index.asp</a></li>
<li><a href="http://w3help.org/zh-cn/causes/RM8015">http://w3help.org/zh-cn/causes/RM8015</a></li>
</ul>
<div>&nbsp;&nbsp;</div></div>
